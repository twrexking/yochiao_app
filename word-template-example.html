<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word å¥—ç‰ˆå·¥å…·ç¨‹å¼åº« - ä½¿ç”¨ç¯„ä¾‹</title>
    <style>
        body {
            font-family: -apple-system, Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #005a9e;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .example-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid;
        }
        
        .status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        input[type="file"] {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .variable-group {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .variable-group h4 {
            margin-top: 0;
            color: #495057;
        }
        
        input, textarea {
            width: 100%;
            max-width: 400px;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <h1>Word å¥—ç‰ˆå·¥å…·ç¨‹å¼åº« - ä½¿ç”¨ç¯„ä¾‹</h1>
    
    <!-- API èªªæ˜ -->
    <div class="section">
        <h2>ğŸ“š API èªªæ˜</h2>
        
        <h3>åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h3>
        <div class="code-block">
<pre>// 1. å»ºç«‹å¥—ç‰ˆç”Ÿæˆå™¨å¯¦ä¾‹
const generator = new WordTemplateGenerator();

// 2. è¼‰å…¥æ¨£æ¿æª”æ¡ˆ (å¾ template ç›®éŒ„)
await generator.loadTemplate('my_template.docx');

// 3. æº–å‚™è®Šæ•¸è³‡æ–™
const variables = {
    CompanyName: 'å‹å–¬ç’°å¢ƒç›£æ¸¬å…¬å¸',
    ProjectName: 'ç’°å¢ƒç›£æ¸¬å°ˆæ¡ˆ',
    Date: new Date(),
    ClientData: [
        { Name: 'å®¢æˆ¶A', Address: 'å°åŒ—å¸‚' },
        { Name: 'å®¢æˆ¶B', Address: 'æ–°åŒ—å¸‚' }
    ]
};

// 4. ç”Ÿæˆä¸¦ä¸‹è¼‰æ–‡æª”
await generator.generateAndDownload(variables, 'ç›£æ¸¬å ±å‘Š.docx');</pre>
        </div>
        
        <h3>ä¸»è¦æ–¹æ³•</h3>
        <ul>
            <li><strong>loadTemplate(templatePath)</strong> - å¾ template ç›®éŒ„è¼‰å…¥æ¨£æ¿</li>
            <li><strong>loadTemplateFromFile(file)</strong> - å¾ File ç‰©ä»¶è¼‰å…¥æ¨£æ¿</li>
            <li><strong>generateDocument(variables, options)</strong> - ç”Ÿæˆæ–‡æª”ï¼Œè¿”å› ArrayBuffer</li>
            <li><strong>generateAndDownload(variables, filename, options)</strong> - ç”Ÿæˆä¸¦ä¸‹è¼‰æ–‡æª”</li>
            <li><strong>getVariablesSuggestions(variables)</strong> - å–å¾—è®Šæ•¸ä½¿ç”¨å»ºè­°</li>
        </ul>
    </div>
    
    <!-- äº’å‹•å¼ç¯„ä¾‹ -->
    <div class="section">
        <h2>ğŸ¯ äº’å‹•å¼ç¯„ä¾‹</h2>
        
        <div class="example-controls">
            <button class="btn" onclick="loadExampleTemplate()">è¼‰å…¥ç¯„ä¾‹æ¨£æ¿</button>
            <input type="file" id="fileInput" accept=".docx" onchange="loadUserTemplate(this.files[0])">
            <button class="btn btn-secondary" onclick="showVariablesSuggestions()">é¡¯ç¤ºè®Šæ•¸å»ºè­°</button>
        </div>
        
        <div id="status"></div>
        
        <!-- è®Šæ•¸è¨­å®šå€åŸŸ -->
        <div class="variable-group">
            <h4>ğŸ“ åŸºæœ¬è®Šæ•¸</h4>
            <label>å…¬å¸åç¨±:</label>
            <input type="text" id="companyName" value="å‹å–¬ç’°å¢ƒç›£æ¸¬å…¬å¸" placeholder="è¼¸å…¥å…¬å¸åç¨±">
            
            <label>å°ˆæ¡ˆåç¨±:</label>
            <input type="text" id="projectName" value="ç’°å¢ƒç›£æ¸¬å°ˆæ¡ˆ" placeholder="è¼¸å…¥å°ˆæ¡ˆåç¨±">
            
            <label>è¯çµ¡äºº:</label>
            <input type="text" id="contactPerson" value="å¼µç¶“ç†" placeholder="è¼¸å…¥è¯çµ¡äºº">
            
            <label>å‚™è¨»èªªæ˜:</label>
            <textarea id="notes" placeholder="è¼¸å…¥å‚™è¨»èªªæ˜">æœ¬æ¬¡ç›£æ¸¬ä¾æ“šç’°ä¿ç½²ç›¸é—œè¦å®šåŸ·è¡Œï¼Œç¢ºä¿ç’°å¢ƒå“è³ªç¬¦åˆæ¨™æº–ã€‚</textarea>
        </div>
        
        <div class="variable-group">
            <h4>ğŸ“Š è³‡æ–™æ¸…å–® (é™£åˆ—)</h4>
            <label>ç›£æ¸¬é …ç›®æ¸…å–® (æ¯è¡Œä¸€é …):</label>
            <textarea id="monitoringItems" placeholder="è«‹è¼¸å…¥ç›£æ¸¬é …ç›®ï¼Œæ¯è¡Œä¸€é …">ç©ºæ°£å“è³ªç›£æ¸¬
æ°´è³ªç›£æ¸¬
å™ªéŸ³ç›£æ¸¬
åœŸå£¤æª¢æ¸¬</textarea>
        </div>
        
        <div class="variable-group">
            <h4>ğŸ“‹ è³‡æ–™è¡¨æ ¼ (ç‰©ä»¶é™£åˆ—)</h4>
            <p>å®¢æˆ¶è³‡æ–™è¡¨:</p>
            <div id="clientTableContainer">
                <div class="client-row">
                    <input type="text" placeholder="å®¢æˆ¶åç¨±" value="ABCç§‘æŠ€å…¬å¸">
                    <input type="text" placeholder="è¯çµ¡åœ°å€" value="å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ">
                    <input type="number" placeholder="å“¡å·¥äººæ•¸" value="150">
                    <button class="btn btn-secondary" onclick="removeClientRow(this)">åˆªé™¤</button>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="addClientRow()">æ–°å¢å®¢æˆ¶</button>
        </div>
        
        <div class="example-controls">
            <button class="btn" onclick="generatePreviewDocument()">ç”Ÿæˆæ–‡æª”</button>
            <button class="btn" onclick="downloadDocument()">ä¸‹è¼‰æ–‡æª”</button>
        </div>
        
        <div id="variablesSuggestions"></div>
    </div>
    
    <!-- è®Šæ•¸èªæ³•èªªæ˜ -->
    <div class="section">
        <h2>ğŸ’¡ æ¨£æ¿è®Šæ•¸èªæ³•èªªæ˜</h2>
        
        <h3>ç°¡å–®è®Šæ•¸</h3>
        <div class="code-block">
<pre>{{CompanyName}}     â†’ å‹å–¬ç’°å¢ƒç›£æ¸¬å…¬å¸
{{ProjectName}}     â†’ ç’°å¢ƒç›£æ¸¬å°ˆæ¡ˆ
{{Date}}            â†’ 2025å¹´9æœˆ22æ—¥</pre>
        </div>
        
        <h3>é™£åˆ—è®Šæ•¸ (æ¸…å–®)</h3>
        <div class="code-block">
<pre>{{FOR item IN MonitoringItems}}
- {{item}}
{{END-FOR item}}

è¼¸å‡º:
- ç©ºæ°£å“è³ªç›£æ¸¬
- æ°´è³ªç›£æ¸¬
- å™ªéŸ³ç›£æ¸¬</pre>
        </div>
        
        <h3>ç‰©ä»¶é™£åˆ— (è¡¨æ ¼)</h3>
        <div class="code-block">
<pre>{{FOR client IN ClientData}}
å®¢æˆ¶: {{client.Name}}
åœ°å€: {{client.Address}}
å“¡å·¥: {{client.EmpCount}}äºº
{{END-FOR client}}

è¼¸å‡º:
å®¢æˆ¶: ABCç§‘æŠ€å…¬å¸
åœ°å€: å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ
å“¡å·¥: 150äºº</pre>
        </div>
        
        <h3>é€²éšåŠŸèƒ½</h3>
        <div class="code-block">
<pre>// æ¢ä»¶åˆ¤æ–·
{{IF ClientData.length > 0}}
å…±æœ‰ {{ClientData.length}} å€‹å®¢æˆ¶
{{END-IF}}

// æ—¥æœŸæ ¼å¼åŒ–
{{formatDate(Date)}}

// æ•¸å­—æ ¼å¼åŒ–
{{formatNumber(Amount, 2)}}</pre>
        </div>
    </div>

    <!-- è¼‰å…¥å¥—ç‰ˆå·¥å…· -->
    <script src="word-template-generator.js"></script>
    <script>
        let generator = null;
        let currentVariables = {};
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                generator = new WordTemplateGenerator();
                showStatus('Word å¥—ç‰ˆå·¥å…·å·²æº–å‚™å°±ç·’', 'success');
            } catch (error) {
                showStatus('åˆå§‹åŒ–å¤±æ•—: ' + error.message, 'error');
            }
        });
        
        // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }
        
        // è¼‰å…¥ç¯„ä¾‹æ¨£æ¿
        async function loadExampleTemplate() {
            try {
                showStatus('æ­£åœ¨è¼‰å…¥ç¯„ä¾‹æ¨£æ¿...', 'info');
                
                // å˜—è©¦è¼‰å…¥å°ˆæ¡ˆä¸­çš„æ¨£æ¿æª”æ¡ˆ
                const templateFiles = ['my_template.docx', 'my_template2.docx'];
                let loaded = false;
                
                for (const templateFile of templateFiles) {
                    try {
                        const result = await generator.loadTemplate(templateFile);
                        showStatus(`${result.message} (å¤§å°: ${(result.size / 1024).toFixed(1)} KB)`, 'success');
                        loaded = true;
                        break;
                    } catch (error) {
                        console.log(`å˜—è©¦è¼‰å…¥ ${templateFile} å¤±æ•—:`, error.message);
                    }
                }
                
                if (!loaded) {
                    showStatus('æ‰¾ä¸åˆ°ç¯„ä¾‹æ¨£æ¿æª”æ¡ˆï¼Œè«‹æ‰‹å‹•ä¸Šå‚³ .docx æª”æ¡ˆ', 'error');
                }
            } catch (error) {
                showStatus('è¼‰å…¥ç¯„ä¾‹æ¨£æ¿å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // è¼‰å…¥ä½¿ç”¨è€…æ¨£æ¿
        async function loadUserTemplate(file) {
            if (!file) return;
            
            try {
                showStatus('æ­£åœ¨è¼‰å…¥æ¨£æ¿...', 'info');
                const result = await generator.loadTemplateFromFile(file);
                showStatus(`${result.message} (å¤§å°: ${(result.size / 1024).toFixed(1)} KB)`, 'success');
            } catch (error) {
                showStatus('è¼‰å…¥æ¨£æ¿å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // æ”¶é›†è®Šæ•¸è³‡æ–™
        function collectVariables() {
            // åŸºæœ¬è®Šæ•¸
            const variables = {
                CompanyName: document.getElementById('companyName').value,
                ProjectName: document.getElementById('projectName').value,
                ContactPerson: document.getElementById('contactPerson').value,
                Notes: document.getElementById('notes').value,
                Date: new Date()
            };
            
            // ç›£æ¸¬é …ç›®æ¸…å–® (é™£åˆ—)
            const itemsText = document.getElementById('monitoringItems').value;
            variables.MonitoringItems = itemsText.split('\n')
                .map(item => item.trim())
                .filter(item => item.length > 0);
            
            // å®¢æˆ¶è³‡æ–™è¡¨ (ç‰©ä»¶é™£åˆ—)
            const clientRows = document.querySelectorAll('#clientTableContainer .client-row');
            variables.ClientData = Array.from(clientRows).map(row => {
                const inputs = row.querySelectorAll('input');
                return {
                    Name: inputs[0].value || '',
                    Address: inputs[1].value || '',
                    EmpCount: parseInt(inputs[2].value) || 0
                };
            }).filter(client => client.Name.trim().length > 0);
            
            currentVariables = variables;
            return variables;
        }
        
        // ç”Ÿæˆé è¦½æ–‡æª”
        async function generatePreviewDocument() {
            try {
                showStatus('æ­£åœ¨ç”Ÿæˆæ–‡æª”...', 'info');
                const variables = collectVariables();
                
                const buffer = await generator.generateDocument(variables);
                showStatus(`æ–‡æª”ç”ŸæˆæˆåŠŸ (å¤§å°: ${(buffer.byteLength / 1024).toFixed(1)} KB)`, 'success');
                
                // é¡¯ç¤ºè®Šæ•¸æ‘˜è¦
                displayVariablesSummary(variables);
            } catch (error) {
                showStatus('ç”Ÿæˆæ–‡æª”å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // ä¸‹è¼‰æ–‡æª”
        async function downloadDocument() {
            try {
                const variables = collectVariables();
                const filename = `${variables.ProjectName || 'æ–‡æª”'}_${new Date().toISOString().slice(0, 10)}.docx`;
                
                const result = await generator.generateAndDownload(variables, filename);
                showStatus(`æ–‡æª”ä¸‹è¼‰å®Œæˆ: ${result.filename}`, 'success');
            } catch (error) {
                showStatus('ä¸‹è¼‰æ–‡æª”å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // é¡¯ç¤ºè®Šæ•¸å»ºè­°
        function showVariablesSuggestions() {
            const variables = collectVariables();
            const suggestions = generator.getVariablesSuggestions(variables);
            
            let html = '<div class="variable-group"><h4>ğŸ”§ è®Šæ•¸ä½¿ç”¨å»ºè­°</h4>';
            
            if (suggestions.simple.length > 0) {
                html += '<h5>ç°¡å–®è®Šæ•¸:</h5><div class="code-block"><pre>';
                suggestions.simple.forEach(item => {
                    html += `${item.syntax}\n`;
                });
                html += '</pre></div>';
            }
            
            if (suggestions.arrays.length > 0) {
                html += '<h5>é™£åˆ—è®Šæ•¸:</h5><div class="code-block"><pre>';
                suggestions.arrays.forEach(item => {
                    html += `${item.syntax}\n`;
                });
                html += '</pre></div>';
            }
            
            if (suggestions.objects.length > 0) {
                html += '<h5>ç‰©ä»¶é™£åˆ—:</h5><div class="code-block"><pre>';
                suggestions.objects.forEach(item => {
                    html += `${item.syntax}\n`;
                    html += `å¯ç”¨æ¬„ä½: ${item.fields.join(', ')}\n\n`;
                });
                html += '</pre></div>';
            }
            
            html += '</div>';
            
            document.getElementById('variablesSuggestions').innerHTML = html;
        }
        
        // é¡¯ç¤ºè®Šæ•¸æ‘˜è¦
        function displayVariablesSummary(variables) {
            let html = '<div class="variable-group"><h4>ğŸ“Š ä½¿ç”¨çš„è®Šæ•¸æ‘˜è¦</h4><ul>';
            
            Object.entries(variables).forEach(([key, value]) => {
                if (Array.isArray(value)) {
                    if (value.length > 0 && typeof value[0] === 'object') {
                        html += `<li><strong>${key}</strong>: ç‰©ä»¶é™£åˆ— (${value.length} é …)</li>`;
                    } else {
                        html += `<li><strong>${key}</strong>: é™£åˆ— (${value.length} é …)</li>`;
                    }
                } else {
                    html += `<li><strong>${key}</strong>: ${value}</li>`;
                }
            });
            
            html += '</ul></div>';
            
            document.getElementById('variablesSuggestions').innerHTML = html;
        }
        
        // æ–°å¢å®¢æˆ¶è¡Œ
        function addClientRow() {
            const container = document.getElementById('clientTableContainer');
            const newRow = document.createElement('div');
            newRow.className = 'client-row';
            newRow.innerHTML = `
                <input type="text" placeholder="å®¢æˆ¶åç¨±">
                <input type="text" placeholder="è¯çµ¡åœ°å€">
                <input type="number" placeholder="å“¡å·¥äººæ•¸">
                <button class="btn btn-secondary" onclick="removeClientRow(this)">åˆªé™¤</button>
            `;
            container.appendChild(newRow);
        }
        
        // åˆªé™¤å®¢æˆ¶è¡Œ
        function removeClientRow(button) {
            const rows = document.querySelectorAll('#clientTableContainer .client-row');
            if (rows.length > 1) {
                button.closest('.client-row').remove();
            } else {
                showStatus('è‡³å°‘éœ€è¦ä¿ç•™ä¸€è¡Œè³‡æ–™', 'error');
            }
        }
    </script>
</body>
</html>