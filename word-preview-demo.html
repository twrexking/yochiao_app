<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>友喬環境監測系統 - Word 文件預覽測試</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .demo-title {
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .demo-controls {
            margin-bottom: 20px;
        }
        .demo-controls button {
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .code-example {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>Word 文件預覽功能測試</h1>
        
        <!-- 基本預覽功能 -->
        <div class="demo-section">
            <h2 class="demo-title">1. 基本文件預覽</h2>
            <p>選擇一個 .docx 文件進行預覽（支援拖拽）</p>
            <div id="basicPreview"></div>
        </div>
        
        <!-- 程式化調用示例 -->
        <div class="demo-section">
            <h2 class="demo-title">2. 程式化調用</h2>
            <p>透過程式碼直接調用預覽功能</p>
            
            <div class="demo-controls">
                <button class="btn" onclick="previewSampleDocument()">預覽範例文件</button>
                <button class="btn" onclick="clearPreview()">清除預覽</button>
                <input type="file" id="manualFileInput" accept=".docx" style="display: none;" onchange="handleManualFile(event)">
                <button class="btn" onclick="document.getElementById('manualFileInput').click()">選擇文件</button>
            </div>
            
            <div id="programmaticPreview" style="min-height: 300px; border: 1px solid #eee; padding: 10px; background: #fafafa;">
                <div style="text-align: center; color: #999; padding: 40px;">
                    點擊上方按鈕開始預覽
                </div>
            </div>
        </div>
        
        <!-- API 使用說明 -->
        <div class="demo-section">
            <h2 class="demo-title">3. API 使用說明</h2>
            
            <h3>初始化</h3>
            <div class="code-example">
// 自動初始化（函式庫會在需要時自動載入）
await WordPreviewLib.init();
            </div>
            
            <h3>預覽文件 - 多種方式</h3>
            <div class="code-example">
// 1. 從 File 物件預覽
const file = document.getElementById('fileInput').files[0];
await WordPreviewLib.previewDocument(file, 'previewContainer');

// 2. 從 Blob 預覽
const blob = new Blob([arrayBuffer], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
await WordPreviewLib.previewDocument(blob, 'previewContainer');

// 3. 從檔案路徑預覽
await WordPreviewLib.previewDocument('path/to/document.docx', 'previewContainer');

// 4. 從 ArrayBuffer 預覽
await WordPreviewLib.previewDocument(arrayBuffer, 'previewContainer');
            </div>
            
            <h3>建立完整的預覽 UI</h3>
            <div class="code-example">
// 建立包含文件選擇器的完整 UI
WordPreviewLib.createPreviewUI('containerId', {
    showFileInput: true,    // 顯示文件選擇器
    allowDrop: true,        // 允許拖拽上傳
    title: '文件預覽'       // 自訂標題
});
            </div>
            
            <h3>清除預覽</h3>
            <div class="code-example">
// 清除指定容器的預覽內容
WordPreviewLib.clearPreview('previewContainer');
            </div>
            
            <h3>自訂選項</h3>
            <div class="code-example">
const options = {
    className: 'custom-docx-preview',
    inWrapper: true,
    ignoreWidth: false,
    ignoreHeight: false,
    breakPages: true,
    renderHeaders: true,
    renderFooters: true,
    debug: false
};

await WordPreviewLib.previewDocument(file, 'container', options);
            </div>
        </div>
        
        <!-- 整合到專案系統 -->
        <div class="demo-section">
            <h2 class="demo-title">4. 整合到專案系統</h2>
            <p>如何整合到友喬環境監測系統的專案管理中：</p>
            
            <div class="code-example">
// 在 projects.js 中添加預覽功能
Projects.previewDocument = async function(projectId, docType) {
    try {
        // 產生文件 blob
        const documentBlob = await this.generateDocumentBlob(projectId, docType);
        
        // 顯示預覽模態框
        const modal = document.getElementById('documentPreviewModal');
        Common.showModal('documentPreview');
        
        // 預覽文件
        await WordPreviewLib.previewDocument(documentBlob, 'documentPreviewContainer');
        
    } catch (error) {
        console.error('文件預覽失敗:', error);
        Common.showNotification('文件預覽失敗: ' + error.message, 'error');
    }
};

// 修改現有的預覽按鈕
// 原本: &lt;button onclick="Projects.previewPlan()"&gt;預覽&lt;/button&gt;
// 改為: &lt;button onclick="Projects.previewDocument(Projects.currentProjectId, 'plan')"&gt;預覽&lt;/button&gt;
            </div>
        </div>
    </div>
    
    <!-- 載入函式庫 -->
    <script src="word-preview-lib.js"></script>
    <script src="common.js"></script>
    
    <script>
        // 初始化基本預覽 UI
        document.addEventListener('DOMContentLoaded', function() {
            WordPreviewLib.createPreviewUI('basicPreview', {
                title: '基本 Word 文件預覽',
                showFileInput: true,
                allowDrop: true
            });
        });
        
        // 程式化預覽範例
        async function previewSampleDocument() {
            const container = document.getElementById('programmaticPreview');
            
            // 模擬從伺服器獲取文件
            try {
                // 這裡可以改為實際的文件路徑
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">請先選擇一個實際的 .docx 文件進行測試</div>';
                
                // 實際使用時的範例：
                // await WordPreviewLib.previewDocument('template/my_template.docx', container);
                
            } catch (error) {
                WordPreviewLib.showErrorState(container, error.message);
            }
        }
        
        // 手動文件選擇
        async function handleManualFile(event) {
            const file = event.target.files[0];
            if (file) {
                const container = document.getElementById('programmaticPreview');
                await WordPreviewLib.previewDocument(file, container);
            }
        }
        
        // 清除預覽
        function clearPreview() {
            WordPreviewLib.clearPreview('programmaticPreview');
            document.getElementById('programmaticPreview').innerHTML = 
                '<div style="text-align: center; color: #999; padding: 40px;">點擊上方按鈕開始預覽</div>';
        }
    </script>
</body>
</html>